---
title: "TSIC Getting Started"
author: "Phillip Labuschagne"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TSIC Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This guide assumes that you successfully installed `tsic` - this is when you run `library(tsic)` in R, you do not get any errors.

```{r}
library(tsic)
```

The current version of the guide will only consider a single participant. You have to write the code that will read in your datasets and that will loop over the individual persons in the dataset and select out their data into the format that `tsic` requires. Feel free to ask the package author for help.

The main data structure is the diagnostic history which contains a single patient's test result history. This is usually assigned to a variable named `ihist` (which is short of individual history). Below is an example of such an history. The column names and order must be matched exactly.

```{r}
ihist <- data.frame(
  ptid = c('p0', 'p0'),
  sample_date = c(as.numeric(as.Date('2019-04-01')), as.numeric(as.Date('2019-05-01'))),
  test = c('architect_weib3_delaney', 'architect_weib3_delaney'),
  result = c('-', '+'),
  stringsAsFactors = FALSE
)
ihist$sample_date <- ihist$sample_date + 0.5
```

```{r echo=FALSE,results='asis'}
knitr::kable(ihist)
```


Note: `sample_date` is expressed as a `numeric`. (The number of days since 1970-01-01)

Note: It will almost always make sense to add 0.5 to the sample date, since it is more likely that the visit occurred at noon than at midnight.

Note: The test names must match those available from the `get_assay_dynamics()` function. Listed below:

```{r}
# running this will print the available assays
get_assay_dynamics()
```

Once the `ihist` is constructed, it must be 'interpreted'. This is the process by which the individual results are interpreted into curves that describe the probability (indicated by the y-axis) of observing the result for various possible infection dates (indicated by the x-axis). Since `tsic` should be able to operate accurately on step functions (which have discontinuities in their derivatives), there is a fair bit going on in the `interpret_ihist` function.

The `range_start` and `range_end` arguments should be set to such values that at least one of the curves will be extremely close to 0 outside of the range.

```{r}
iihist <- interpret_ihist(ihist = ihist,
                          range_start = as.numeric(as.Date('2019-02-01')),
                          range_end = as.numeric(as.Date('2019-06-15')),
                          verbose = FALSE)
```

```{r echo=FALSE,results='asis'}
tmp_iihist <- iihist
tmp_iihist$test_details <- gsub('\\\n', ' ', tmp_iihist$test_details)
knitr::kable(tmp_iihist[1:15,])
rm(tmp_iihist)
```





Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
